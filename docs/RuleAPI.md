# Rule Management API

Cirrus exposes a REST API via API Gateway to manage anomaly detection rules.

---

## Endpoints

| Method | Path            | Description         |
| ------ | --------------- | ------------------- |
| GET    | /rules          | Get all rules       |
| POST   | /rules          | Create a new rule   |
| GET    | /rules/{ruleId} | Get rule by ID      |
| DELETE | /rules/{ruleId} | Delete a rule by ID |

---

## Rule Schema

- **ruleId**: Unique identifier (generated by Cirrus).
- **ruleName**: Descriptive name.
- **ruleType**: `count-based` (currently supported).
- **metric**: AWS event to monitor (e.g., `CreateBucket`).
- **threshold**: Maximum allowed occurrences.
- **timeWindow**: Time frame in minutes.
- **target**: AWS identity to monitor (optional).

---

## Examples

### 1. Create Rule

Create a rule for excessive S3 bucket creations:

```http
POST /rules
Content-Type: application/json

{
  "ruleName": "S3 CreateBucket Anomaly",
  "ruleType": "count-based",
  "metric": "CreateBucket",
  "threshold": 5,
  "timeWindow": 10,
  "target": "arn:aws:iam::123456789012:user/Radha"
}
```

**Response:**

```json
{
  "ruleId": "ba3689f2-c9e8-4fb7-8012-891eafcccd56",
  "ruleName": "S3 CreateBucket Anomaly",
  "ruleType": "count-based",
  "metric": "CreateBucket",
  "threshold": 5,
  "timeWindow": 10,
  "target": "arn:aws:iam::123456789012:user/Radha",
  "createdAt": "2025-09-16T15:30:00Z"
}
```

---

### 2. List Rules

Retrieve all rules:

```http
GET /rules
```

**Response:**

```json
[
  {
    "ruleId": "ba3689f2-c9e8-4fb7-8012-891eafcccd56",
    "ruleName": "S3 CreateBucket Anomaly",
    "ruleType": "count-based",
    "metric": "CreateBucket",
    "threshold": 5,
    "timeWindow": 10,
    "target": "arn:aws:iam::123456789012:user/Radha",
    "createdAt": "2025-09-16T15:30:00Z"
  }
]
```

---

### 3. Get Rule by ID

Retrieve a specific rule:

```http
GET /rules/ba3689f2-c9e8-4fb7-8012-891eafcccd56
```

**Response:**

```json
{
  "ruleId": "ba3689f2-c9e8-4fb7-8012-891eafcccd56",
  "ruleName": "S3 CreateBucket Anomaly",
  "ruleType": "count-based",
  "metric": "CreateBucket",
  "threshold": 5,
  "timeWindow": 10,
  "target": "arn:aws:iam::123456789012:user/Radha",
  "createdAt": "2025-09-16T15:30:00Z"
}
```

---

### 4. Delete Rule

Delete a specific rule:

```http
DELETE /rules/ba3689f2-c9e8-4fb7-8012-891eafcccd56
```

**Response:**

```json
{
  "message": "Rule deleted successfully",
  "ruleId": "ba3689f2-c9e8-4fb7-8012-891eafcccd56"
}
```

---

The Rule Management Lambda handles storing, retrieving, and deleting rules in DynamoDB.
